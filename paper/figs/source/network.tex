\documentclass[border=8pt, multi, tikz]{standalone}
\usepackage{import}
\subimport{layers/}{init}
\usetikzlibrary{positioning}
\usetikzlibrary{3d}


\def\ConvColor{rgb:yellow,5;red,2.5;white,5}
\def\ConvReluColor{rgb:yellow,5;red,5;white,5}
\def\PoolColor{rgb:red,1;black,0.3}
\def\UnpoolColor{rgb:blue,2;green,1;black,0.3}
\def\FcColor{rgb:blue,5;red,2.5;white,5}
\def\FcReluColor{rgb:blue,5;red,5;white,4}
\def\SoftmaxColor{rgb:magenta,5;black,7}
\def\BottleneckColor{rgb:green,5;blue,3;white,2}
\def\TextColor{rgb:orange,5;white,3}


\newcommand{\copymidarrow}{\tikz \draw[-Stealth,line width=0.8mm,draw={rgb:blue,4;red,1;green,1;black,3}] (-0.3,0) -- ++(0.3,0);}

\begin{document}
\begin{tikzpicture}
\tikzstyle{connection}=[ultra thick,every node/.style={sloped,allow upside down},draw={rgb:blue,4;red,1;green,1;black,3},opacity=0.7]
\tikzstyle{copyconnection}=[ultra thick,every node/.style={sloped,allow upside down},draw={rgb:blue,4;red,1;green,1;black,3},opacity=0.7]

%%%% ENCODER %%%%

%%% Layer 1: Input (video, audio, text) %%%
% Video input
\pic[shift={(0,2,0)}] at (0,0,0) {
    Box={
        name=input_video,
        caption=Video Input,
        xlabel={{" "}},
        zlabel=43200,
        fill=\ConvColor,
        height=35,
        width=2,
        depth=35
    }
};

% Audio input
\pic[shift={(0,0,0)}] at (0,0,0) {
    Box={
        name=input_audio,
        caption=Audio Input,
        xlabel={{" "}},
        zlabel=2048,
        fill=\ConvColor,
        height=25,
        width=2,
        depth=25
    }
};

% Text input
\pic[shift={(0,-2,0)}] at (0,0,0) {
    Box={
        name=input_text,
        caption=Text Input,
        xlabel={{" "}},
        zlabel=1024,
        fill=\TextColor,
        height=20,
        width=2,
        depth=20
    }
};

%%% Layer 2A: Video Encoder (Conv2D) %%%
\pic[shift={(2.5,2,0)}] at (0,0,0) {
    Box={
        name=video_conv,
        caption=Layer 2A,
        xlabel={{" "}},
        zlabel=1024,
        fill=\ConvReluColor,
        height=30,
        width=3,
        depth=30
    }
};
\draw [connection] (input_video-east) -- node {\midarrow} (video_conv-west);

%%% Layer 2B: Audio Encoder (Conv1D) %%%
\pic[shift={(2.5,0,0)}] at (0,0,0) {
    Box={
        name=audio_conv,
        caption=Layer 2B,
        xlabel={{" "}},
        zlabel=256,
        fill=\ConvReluColor,
        height=18,
        width=3,
        depth=18
    }
};
\draw [connection] (input_audio-east) -- node {\midarrow} (audio_conv-west);

%%% Layer 2C: Text Encoder (Linear) %%%
\pic[shift={(2.5,-2,0)}] at (0,0,0) {
    Box={
        name=text_linear,
        caption=Layer 2C,
        xlabel={{" "}},
        zlabel=256,
        fill=\FcReluColor,
        height=16,
        width=3,
        depth=16
    }
};
\draw [connection] (input_text-east) -- node {\midarrow} (text_linear-west);

%%% Layer 3: Pooled Features (Concatenation) %%%
\pic[shift={(5.5,0,0)}] at (0,0,0) {
    Box={
        name=pool_concat,
        caption=Layer 3,
        xlabel={{" "}},
        zlabel=1536,
        fill=\PoolColor,
        height=28,
        width=2,
        depth=28,
        opacity=0.6
    }
};
\draw [connection] (video_conv-east) -- node {\midarrow} (pool_concat-west);
\draw [connection] (audio_conv-east) -- node {\midarrow} (pool_concat-west);
\draw [connection] (text_linear-east) -- node {\midarrow} (pool_concat-west);

%%% Layer 4: Feature Convolution + ReLU %%%
\pic[shift={(8,0,0)}] at (0,0,0) {
    Box={
        name=feature_conv,
        caption=Layer 4,
        xlabel={{" "}},
        zlabel=1536,
        fill=\ConvReluColor,
        height=28,
        width=3,
        depth=28
    }
};
\draw [connection] (pool_concat-east) -- node {\midarrow} (feature_conv-west);

%%% Layer 5: Linear to Voxels %%%
\pic[shift={(11,0,0)}] at (0,0,0) {
    Box={
        name=to_voxels,
        caption=Layer 5,
        xlabel={{" "}},
        zlabel=85810,
        fill=\FcColor,
        height=38,
        width=2,
        depth=38
    }
};
\draw [connection] (feature_conv-east) -- node {\midarrow} (to_voxels-west);

%%% Layer 6: Bottleneck (SMALLEST/MIDDLE LAYER) %%%
\pic[shift={(13.5,0,0)}] at (0,0,0) {
    Box={
        name=bottleneck,
        caption=Layer 6,
        xlabel={{" "}},
        zlabel=8000,
        fill=\BottleneckColor,
        height=22,
        width=4,
        depth=22,
        opacity=0.8
    }
};
\draw [connection] (to_voxels-east) -- node {\midarrow} (bottleneck-west);

%%%% DECODER (SYMMETRIC) %%%%

%%% Layer 7: Expand from Bottleneck %%%
\pic[shift={(17,0,0)}] at (0,0,0) {
    Box={
        name=from_bottleneck,
        caption=Layer 7,
        xlabel={{" "}},
        zlabel=2048,
        fill=\FcColor,
        height=26,
        width=2,
        depth=26
    }
};
\draw [connection] (bottleneck-east) -- node {\midarrow} (from_bottleneck-west);

%%% Layer 8: Feature Deconv + ReLU %%%
\pic[shift={(19.5,0,0)}] at (0,0,0) {
    Box={
        name=feature_deconv,
        caption=Layer 8,
        xlabel={{" "}},
        zlabel=4096,
        fill=\UnpoolColor,
        height=28,
        width=3,
        depth=28,
        opacity=0.6
    }
};
\draw [connection] (from_bottleneck-east) -- node {\midarrow} (feature_deconv-west);

%%% Layer 9: Unpool Features %%%
\pic[shift={(22.5,0,0)}] at (0,0,0) {
    Box={
        name=unpool,
        caption=Layer 9,
        xlabel={{" "}},
        zlabel=8192,
        fill=\UnpoolColor,
        height=30,
        width=2,
        depth=30,
        opacity=0.6
    }
};
\draw [connection] (feature_deconv-east) -- node {\midarrow} (unpool-west);

%%% Layer 10A: Video Decoder %%%
\pic[shift={(25.5,2,0)}] at (0,0,0) {
    Box={
        name=video_decoder,
        caption=Layer 10A,
        xlabel={{" "}},
        zlabel=1024,
        fill=\UnpoolColor,
        height=30,
        width=3,
        depth=30,
        opacity=0.6
    }
};
\draw [connection] (unpool-east) -- node {\midarrow} (video_decoder-west);

%%% Layer 10B: Audio Decoder %%%
\pic[shift={(25.5,0,0)}] at (0,0,0) {
    Box={
        name=audio_decoder,
        caption=Layer 10B,
        xlabel={{" "}},
        zlabel=256,
        fill=\UnpoolColor,
        height=18,
        width=3,
        depth=18,
        opacity=0.6
    }
};
\draw [connection] (unpool-east) -- node {\midarrow} (audio_decoder-west);

%%% Layer 10C: Text Decoder %%%
\pic[shift={(25.5,-2,0)}] at (0,0,0) {
    Box={
        name=text_decoder,
        caption=Layer 10C,
        xlabel={{" "}},
        zlabel=256,
        fill=\FcReluColor,
        height=16,
        width=3,
        depth=16
    }
};
\draw [connection] (unpool-east) -- node {\midarrow} (text_decoder-west);

%%% Layer 11: Outputs %%%
% Video output
\pic[shift={(29,2,0)}] at (0,0,0) {
    Box={
        name=output_video,
        caption=Video Output,
        xlabel={{" "}},
        zlabel=43200,
        fill=\ConvColor,
        height=35,
        width=2,
        depth=35
    }
};
\draw [connection] (video_decoder-east) -- node {\midarrow} (output_video-west);

% Audio output
\pic[shift={(29,0,0)}] at (0,0,0) {
    Box={
        name=output_audio,
        caption=Audio Output,
        xlabel={{" "}},
        zlabel=2048,
        fill=\ConvColor,
        height=25,
        width=2,
        depth=25
    }
};
\draw [connection] (audio_decoder-east) -- node {\midarrow} (output_audio-west);

% Text output
\pic[shift={(29,-2,0)}] at (0,0,0) {
    Box={
        name=output_text,
        caption=Text Output,
        xlabel={{" "}},
        zlabel=1024,
        fill=\TextColor,
        height=20,
        width=2,
        depth=20
    }
};
\draw [connection] (text_decoder-east) -- node {\midarrow} (output_text-west);

\end{tikzpicture}
\end{document}
